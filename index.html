<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="resources/custom.css">
		<link rel="stylesheet" href="resources/css/fa.css">
		<script>
			function init()
			{
				openTab(event,'tablog')
				tablinks = document.getElementsByClassName("tablinks");
				tablinks[0].className += " active";
			}
			function openTab(evt, cityName) {
				var i, tabcontent, tablinks;

				tabcontent = document.getElementsByClassName("tabcontent");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
				}

				tablinks = document.getElementsByClassName("tablinks");
				for (i = 0; i < tablinks.length; i++) {
					tablinks[i].className = tablinks[i].className.replace(" active", "");
				}

				document.getElementById(cityName).style.display = "block";
				evt.currentTarget.className += " active";
			}
		</script>
	</head>
	<body onload="init()">
		<div id="body">
			<table class="table-style" cellspacing="0" cellpadding="0">
				<colgroup>
					<col span="1" style="width: 33%;">
					<col span="1" style="width: 34%;">
					<col span="1" style="width: 33%;">
				</colgroup>
				<tr class="dashboard">
					<td colspan="3">
						<table class="table-input-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 82px">
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-wallet fa-lg fa-fw"></i>&ensp;Wallet</td>
								<td class="right-border1">
									<input id="mining_address" value="" onchange="updateData()" style="width:calc(100% - 12px)" type="text"/>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr class="dashboard">
					<td>
						<table class="table-input-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 135px">
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td><i class="fas fa-server fa-lg fa-fw"></i>&ensp;Daemon-Host</td>
								<td>
									<input id="daemonhost" value=""style="width:100%" onchange="updateData()" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-input-top table-input-top2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 132px">
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td><i class="fas fa-phone-volume fa-lg fa-fw"></i>&ensp;Daemon-Port</td>
								<td>
									<input id="daemonport" value="" onchange="updateData()" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-input-top table-input-top2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 105px">
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td><i class="fas fa-phone-volume fa-lg fa-fw"></i>&ensp;Pool-Port</td>
								<td class="right-border1">
									<input id="poolport" value="" onchange="updateData()" style="width:calc(100% - 12px)" type="text"/>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr class="dashboard top-line">
					<td class="bottom-left-corner">
						<table class="table-input-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 135px">
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td><i class="fas fa-bolt fa-lg fa-fw"></i>&ensp;Ctrl-Port</td>
								<td class="right-border1">
									<input id="ctrlport" value="" onchange="updateData()" style="width:calc(100% + 4px)" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-input-top table-input-top2" cellspacing="0" cellpadding="0">								
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td class="reset">
									<i class="fas fa-chart-bar fa-lg fa-fw"></i>&ensp;Data&ensp;
									<button onclick="resetData()">Reset&ensp;<i class="fas fa-redo fa-flip-horizontal"></i></button>
								</td>
							</tr>
						</table>
					<td class="bottom-right-corner">
						<table class="table-input-top table-input-top2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: 110px">
								<col style="width: *">
							</colgroup>
							<tr class="no-top-line">
								<td>
								</td>
								<td class="right-border1">
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<table class="table-style" cellspacing="0" cellpadding="0">
				<colgroup>
					<col span="1" style="width: 25%;">
					<col span="1" style="width: 25%;">
					<col span="1" style="width: 25%;">
					<col span="1" style="width: 25%;">
				</colgroup>
				<tr>
					<td>
						<table class="table-header table-header-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-tachometer-alt-fast fa-lg fa-fw"></i>&ensp;Graph Rate</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2 table-header-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-route fa-lg fa-fw"></i>&ensp;Solutions</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2 table-header-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-cubes fa-lg fa-fw"></i>&ensp;Blocks Found</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2 table-header-top" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-history fa-lg fa-fw"></i>&ensp;Blocks Found Every</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td>
						<table style="margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" id="data_gps" style="width:100%" type="text" value="0.00 Gps"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" id="data_shares" style="width:100%" type="text" value="0"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0" id="data_blocks" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" id="data_blocketa" style="width:100%" type="text" value="00:00:00s"/>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td>
						<table class="table-header" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-tachometer-alt-fast fa-lg fa-fw"></i>&ensp;Network Graph Rate</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-unlock fa-lg fa-fw"></i>&ensp;Network Difficulty</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-bars fa-lg fa-fw"></i>&ensp;Blockchain Height</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-chart-line fa-lg fa-fw"></i>&ensp;Current Effort</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td>
						<table style="padding-left:0px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0" id="data_netgraphrate" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0" id="data_diff" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0" id="data_height" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0.00%" id="data_currenteffort" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td>
						<table class="table-header" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-users fa-lg fa-fw"></i>&ensp;Workers</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-coins fa-lg fa-fw"></i>&ensp;Est. Revenue Per Day</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-coins fa-lg fa-fw"></i>&ensp;Current Block Rewards</td>
							</tr>
						</table>
					</td>
					<td>
						<table class="table-header table-header2" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td><i class="fas fa-chart-line fa-lg fa-fw"></i>&ensp;Average Effort</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td>
						<table style="padding-left:0px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" id="data_conn" style="width:100%" type="text" value="0"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0.00 XWP" id="data_revenue" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0.00 XWP" id="data_reward" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
					<td>
						<table style="padding-left:20px;margin-top:0px;width:100%;table-layout: fixed;border:0;" cellspacing="0" cellpadding="0">
							<colgroup>
								<col style="width: *">
							</colgroup>
							<tr>
								<td class="data">
									<input disabled="true" value="0.00%" id="data_averageeffort" style="width:100%" type="text"/>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>

			<div class="tab">
			<button class="tablinks tablinks1" onclick="openTab(event, 'tablog')">Log&ensp;<i class="fas fa-scroll"></i></button>
			<button class="tablinks" onclick="openTab(event, 'tabworker')">Worker&ensp;<i class="fas fa-user-hard-hat"></i></button>
			<button class="tablinks" onclick="openTab(event, 'tabblocks')">Blocks&ensp;<i class="fas fa-cubes"></i></button>
			<button class="tablinks tablinks2" onclick="openTab(event, 'tabhelp')">Help&ensp;<i class="fas fa-life-ring"></i></button>
			</div>

			<div id="tablog" class="tabcontent">
				<div id="log">
				</div>
			</div>

			<div id="tabworker" class="tabcontent">
				<div id="workers">
				</div>
			</div>

			<div id="tabblocks" class="tabcontent">
				<div id="blocks">
				</div>
			</div>

			<div id="tabhelp" class="tabcontent">
				<div id="help">
					<h1>Welcome to Swap Micropool!</h1>
					<div id="myDIV">
						<i class="fas fa-broadcast-tower fa-lg fa-fw"></i>&ensp;Default Presets (Mainnet):&ensp;
						<button class="btn" onclick="setNodePreset('localmainnet')">Local Node&ensp;<i class="fas fa-map-marker-alt"></i></button>
						<button class="btn" onclick="setNodePreset('remotemainnet')">Remote Node&ensp;<i class="fas fa-map-marked-alt"></i></button>
					</div>
					<h2>Micropool Setup</h2>
					<p>
						<ol>
							<li>Run the latest Swap Daemon and allow it to fully sync.</li>
								<ul>
									<li><a href="https://github.com/swap-dev/swap/releases/latest" target="_blank">Latest Swap Daemon</a></li>
								</ul>
							<li>Obtain and enter your standard wallet address (prefixed with fh...). </li>
								<ul>
									<li>Mining to exchanges are not supported.</li>
								</ul>
							<li>Point the Daemon-Host to the IP or DNS address of your daemon.</li>
								<ul>
									<li>Use 127.0.0.1 if the daemon is on the same machine as Micropool (recommended).</li>
									<li>Use the ip assigned by your router if on the same network.</li>
								</ul>
							<li>Optionally, download and set up the on-block notify script for the daemon. The default Ctrl-Port will listen for this script.</li>
								<ul>
									<li><a href="https://github.com/swap-dev/on-block-notify/releases/latest" target="_blank">Latest On-Block Notify</a></li>
								</ul>
						</ol>
					</p>
					<h2>Miner Setup</h2>
					<p>
						<ol>
							<li>Point the pool or connection address to the machine running Micropool.</li>
							<li>Set the mining port to 14650.</li>
							<li>Set the username and password as preferred. These are used to identify your rigs in Micropool.</li>
							<li>Optionally, append a number prefixed by a dot after your username (e.g. workername.10) to set the share difficulty for your rig. Difficulty defaults to 1 when left unset.</li>
						</ol>
					</p>
					<h2>Troubleshooting</h2>
					<h3>Deamon connection</h3>
					<p>The error "<i>connect ECONNREFUSED x.x.x.x:19950</i>" indicates that Micropool cannot connect to the Swap Daemon. Check that the Daemon-Host and Daemon-Port is entered correctly, and that there are no firewall blocking the Daemon-Port. If the daemon is not located on the same machine as micropool, you must bind its rpc ip externally (e.g. swapd --rpc-bind-ip 0.0.0.0 --confirm-external-bind --restricted-rpc).</p>
					<p>The error "<i>core is busy</i>" indicates that Swap Daemon has not yet fully synced. You'll not be able to connect your miner until it does so. If this error occurs intermittenly, it means that the daemon is having a hard time maintaining connections with the Swap Network. Check your firewall settings for your Swap Daemon's p2p port.</p>
					<h3>Miner Connection</h3>
					<p>For "<i>No connection could be made because the target machine actively refused it</i>" and similar errors in your miner, make sure there are no errors in Micropool. Micropool will not accept any connections until it is fully ready. If there are no errors in Micropool, make sure the connection info in your miner is correct and that no firewall is blocking the Pool-Port.</p>
					<h3>Mining Efficiency</h3>
					<p>
						For users who are finding abnormal number of orphan blocks or needing lots of efforts to find a block. Listed in order of importances and effiecacy:
						<ul>
							<li>Avoid mining to a public remote node! Public nodes are a shared resource, which will have a hard time serving new blocktemplates to Micropool in a timely manner. Expect a massive number of orphan block while mining directly to one of the more popular nodes! If for some reason you cannot run the Swap Daemon on your local network, setting up a private remote node on a vps is a much better alternative.</li>
							<li>Reduce ping time to your peers. Generally this means don't run your setup on satellite or cellular internet. If you're stuck with high latacy internet, expect a higher than normal orphan rate.
							<li>Ensure that your daemon is well connected to at least 15-20 peers to help distribute your found blocks throughout the network as quickly as possible. If your daemon have a hard time maintaining a good peer list, check and make sure that it is able to accept inbound connection on its p2p port. This will reduce the chance of having your block orphaned or even unintentionally forking onto its own private chain (i.e. multiple orphan blocks). If you still cannot maintain a good peer list, at least make sure that the peers you do have are fully synced (you can help get your peers up to speed by increasing your daemon's max upload speed).</li>
							<li>Setting up on-block notify will ensures that Micropool will always be ready when your daemon detects a new block on the network. This reduces the time wasted on mining a stale block that would be rejected by your daemon anyways. Without on-block notify, micropool will poll the daemon for new blocks every 0.1s (which is already a fairly agressive setting). These milliseconds of delay adds up, and is especially important when mining on Swap Network's 15s block timing. Expect a reduction of ~0.33% effort needed to find each block.</li>
							<li>Reduce ping time between Micropool, Swap Daemon, and Miner. Ideally, they should be on the same machine or local network. Having any part of your setup over the internet will impact mining effort and/or orphan rate due to communication delays.
							<li>Prioritize your daemon's connection to seed nodes using --add-priority-node. Swap's seed nodes are dedicated servers optimized to handle hundreds of concurrent connections at a time. Your daemon will gain access to many of available Swap nodes with only 2 hops away when connected to one.</li>
							<li>Prioritize your daemon's connection to major pools using --add-priority-node. By having a direct connection to the major pools, you not only receive their blocks faster, but they also receive your blocks faster too. By building on each other chain, the chance of orphan blocks decreases for everyone involved. The pool's daemon is usually located on the same ip as the mining address, but you can always ask the pool operator.</li>
						</ul>
					</p>
				</div>
			</div>

		</div>
		
		<script>
			// Add active class to the current button (highlight it)
			var header = document.getElementById("myDIV");
			var btns = header.getElementsByClassName("btn");
			for (var i = 0; i < btns.length; i++) {
			btns[i].addEventListener("click", function() {
			var current = document.getElementsByClassName("active");
			current[0].className = current[0].className.replace(" active", "");
			this.className += " active";
			});
			}

			var electron = require('electron');
			var loglines = [];
			function updateData() { 
			
				if( (document.getElementById('daemonport').value < 1024)||(document.getElementById('daemonport').value > 65535))
					document.getElementById('daemonport').value=19950;
				if( (document.getElementById('poolport').value < 1024)||(document.getElementById('poolport').value > 65535))
					document.getElementById('poolport').value=14650;
				if( (document.getElementById('ctrlport').value < 1024)||(document.getElementById('ctrlport').value > 65535))
					document.getElementById('ctrlport').value=14651;
				
				ipcRenderer.send('set', ['daemonport',parseFloat(document.getElementById('daemonport').value)|0]);
				ipcRenderer.send('set', ['poolport',parseFloat(document.getElementById('poolport').value)|0]);
				ipcRenderer.send('set', ['ctrlport',document.getElementById('ctrlport').value]);
				ipcRenderer.send('set', ['daemonhost',document.getElementById('daemonhost').value]);
				ipcRenderer.send('set', ['mining_address',document.getElementById('mining_address').value]);
			}
			const { ipcRenderer } = require('electron')
			ipcRenderer.send('get', 'daemonport');
			ipcRenderer.send('get', 'poolport');
			ipcRenderer.send('get', 'ctrlport');
			ipcRenderer.send('get', 'daemonhost');
			ipcRenderer.send('get', 'mining_address');
			
			ipcRenderer.on('get-reply', (event, arg) => {
				document.getElementById(arg[0]).value=arg[1];
			})
			ipcRenderer.on('workers', (event, arg) => {
				document.getElementById('workers').innerHTML=arg;
			})
			ipcRenderer.on('blocks', (event, arg) => {
				document.getElementById('blocks').innerHTML=arg;
			})
			ipcRenderer.on('log', (event, msg) => {
				var d = new Date();
				loglines.unshift(d.toISOString()+' <span>['+msg[0]+']</span> '+msg[1]);
				if (loglines.length > 100) loglines.pop();
				document.getElementById('log').innerHTML=loglines.join('<br/>');
			});
			
			function setNodePreset(type) {
				if (type == "localmainnet")
				{
					document.getElementById('daemonhost').value="127.0.0.1";
					document.getElementById('daemonport').value=19950;
				}
				else if (type == "remotemainnet")
				{
					document.getElementById('daemonhost').value="autonode.xwp.fyi";
					document.getElementById('daemonport').value=19950;
				}
				document.getElementById('poolport').value=14650;
				document.getElementById('ctrlport').value=14651;

				updateData();
				tablinks[3].className += " active"; //re-highlight help tab on click
			}
			function resetData() {
				ipcRenderer.send('run', ['resetData']);
			}
		</script>
	</body>
</html>
